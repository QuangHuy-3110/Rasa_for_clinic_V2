version: "3.1"

intents:
  - greet
  - goodbye
  - request_doctor
  - affirm
  - deny
  - provide_medical_info
  - book_with_doctor
  - book_appointment
  - provide_decription
  - provide_specialty
  - choose_doctor_name
  - provide_time
  - provide_date
  - explain_specialty
  - ask_doctor_info
  - list_doctors_by_specialty
  - cancel_appointment
  - select_appointment
  # - provide_cancel_date
  - nlu_fallback
  - out_of_scope
  - search_prescription # ‚Üê TH√äM M·ªöI
  # - provide_prescription_date # ‚Üê TH√äM M·ªöI
  - request_latest_prescription # ‚Üê TH√äM M·ªöI
  - ask_who_examined_me # ‚Üê TH√äM M·ªöI

entities:
  - symptom
  - specialty
  - doctor_name
  - appointment_time
  - decription
  - date
  - time
  - appointment_id
  - doctor_id
  - prescription_date # ‚Üê TH√äM M·ªöI

slots:
  just_asked_examining_doctor: # ‚Üê TH√äM M·ªöI
    type: bool
    initial_value: false
    influence_conversation: true
    mappings:
      - type: custom

  just_listed_doctors:
    type: bool
    initial_value: false
    influence_conversation: true
    mappings:
      - type: custom

  just_explained:
    type: bool
    initial_value: false
    influence_conversation: true
    mappings:
      - type: custom

  just_asked_doctor_info:
    type: bool
    initial_value: false
    influence_conversation: true
    mappings:
      - type: custom

  symptoms:
    type: list
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: symptom

  doctor_id:
    type: text
    influence_conversation: false
    mappings:
      - type: custom

  current_task:
    type: categorical
    influence_conversation: true
    values:
      - request_doctor
      - book_appointment
      - cancel_appointment
      - search_prescription # ‚Üê TH√äM M·ªöI
    mappings:
      - type: custom

  specialty_suggested:
    type: text
    influence_conversation: true
    mappings:
      - type: custom

  appointment_date:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: date
        intent: # ‚Üê TH√äM: H·∫°n ch·∫ø intent ƒë·ªÉ tr√°nh set sai
          # - provide_cancel_date
          - provide_date
      - type: from_text
        intent:
          # - provide_cancel_date
          - provide_date
      - type: custom

  prescription_date:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: prescription_date
        intent: provide_date # ‚Üê THAY ƒê·ªîI: Th√™m h·∫°n ch·∫ø intent
      - type: from_entity
        entity: date
        intent: provide_date
      - type: from_text
        intent: provide_date
      - type: custom
        not_intent: # ‚Üê THAY ƒê·ªîI: Th√™m nlu_fallback v√†o not_intent
          - greet
          - goodbye
          - affirm
          - deny
          - book_appointment
          - request_doctor
          - provide_specialty
          - provide_date
          - provide_time
          - provide_decription
          - provide_medical_info
          - choose_doctor_name
          - book_with_doctor
          - explain_specialty
          - ask_doctor_info
          - list_doctors_by_specialty
          - cancel_appointment
          # - provide_cancel_date
          - select_appointment
          - out_of_scope
          - search_prescription
          - request_latest_prescription
          - nlu_fallback # ‚Üê TH√äM
          - ask_who_examined_me

  search_latest_prescription:
    type: bool
    initial_value: false
    influence_conversation: false
    mappings:
      - type: custom
        not_intent: # ‚Üê THAY ƒê·ªîI: Th√™m nlu_fallback v√†o not_intent
          - greet
          - goodbye
          - affirm
          - deny
          - book_appointment
          - request_doctor
          - provide_specialty
          - provide_date
          - provide_time
          - provide_decription
          - provide_medical_info
          - choose_doctor_name
          - book_with_doctor
          - explain_specialty
          - ask_doctor_info
          - list_doctors_by_specialty
          - cancel_appointment
          # - provide_cancel_date
          - select_appointment
          - out_of_scope
          - search_prescription
          # - provide_date
          - request_latest_prescription
          - nlu_fallback # ‚Üê TH√äM
          - ask_who_examined_me

  doctor_name:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: doctor_name
        intent: # ‚Üê TH√äM: H·∫°n ch·∫ø intent
          - choose_doctor_name
      - type: custom
      - type: from_text
        not_intent: # ‚Üê THAY ƒê·ªîI: Th√™m nlu_fallback v√†o not_intent
          - greet
          - goodbye
          - affirm
          - deny
          - book_appointment
          - request_doctor
          - provide_specialty
          - provide_date
          - provide_time
          - provide_decription
          - provide_medical_info
          - choose_doctor_name
          - book_with_doctor
          - explain_specialty
          - ask_doctor_info
          - list_doctors_by_specialty
          - cancel_appointment
          # - provide_cancel_date
          - select_appointment
          - out_of_scope
          - search_prescription
          # - provide_date
          - request_latest_prescription
          - nlu_fallback # ‚Üê TH√äM
          - ask_who_examined_me

  appointment_time:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: appointment_time
        intent: provide_time # ‚Üê TH√äM: H·∫°n ch·∫ø intent
      - type: from_entity
        entity: time
        intent: provide_time
      - type: from_text
        not_intent: # ‚Üê THAY ƒê·ªîI: Th√™m nlu_fallback v√†o not_intent
          - greet
          - goodbye
          - affirm
          - deny
          - book_appointment
          - request_doctor
          - provide_specialty
          - provide_date
          - choose_doctor_name
          - provide_decription
          - provide_medical_info
          - provide_time
          - book_with_doctor
          - explain_specialty
          - ask_doctor_info
          - list_doctors_by_specialty
          - cancel_appointment
          # - provide_cancel_date
          - select_appointment
          - out_of_scope
          - search_prescription
          # - provide_date
          - request_latest_prescription
          - nlu_fallback # ‚Üê TH√äM
          - ask_who_examined_me
      - type: custom

  decription:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: decription
        intent: # ‚Üê TH√äM: H·∫°n ch·∫ø intent
          - provide_decription
          - provide_medical_info
      - type: from_text
        intent:
          - provide_decription
          - provide_medical_info
      - type: custom

  specialty:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: specialty
      - type: from_entity
        entity: specialty
        intent: provide_specialty
      - type: custom
      - type: from_text
        not_intent: # ‚Üê THAY ƒê·ªîI: Th√™m nlu_fallback v√†o not_intent
          - greet
          - goodbye
          - affirm
          - deny
          - book_appointment
          - request_doctor
          - provide_date
          - choose_doctor_name
          - provide_time
          - provide_decription
          - provide_medical_info
          - provide_specialty
          - book_with_doctor
          - ask_doctor_info
          - list_doctors_by_specialty
          - cancel_appointment
          # - provide_cancel_date
          - select_appointment
          - out_of_scope
          - search_prescription
          # - provide_date
          - request_latest_prescription
          - nlu_fallback # ‚Üê TH√äM
          - ask_who_examined_me

  date:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: date
        intent: # ‚Üê TH√äM: H·∫°n ch·∫ø intent ƒë·ªÉ tr√°nh set sai tr√™n fallback
          - provide_date
      - type: from_text
        not_intent: # ‚Üê THAY ƒê·ªîI: Th√™m nlu_fallback v√†o not_intent
          - greet
          - goodbye
          - affirm
          - deny
          - book_appointment
          - request_doctor
          - provide_specialty
          - choose_doctor_name
          - provide_time
          - provide_decription
          - provide_medical_info
          - provide_date
          - book_with_doctor
          - explain_specialty
          - ask_doctor_info
          - list_doctors_by_specialty
          - cancel_appointment
          # - provide_cancel_date
          - select_appointment
          - out_of_scope
          - search_prescription
          # - provide_date
          - request_latest_prescription
          - nlu_fallback # ‚Üê TH√äM
          - ask_who_examined_me
      - type: custom

  selected_appointment_id:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: appointment_id
      - type: custom

responses:
  utter_select_appointment:
    - text: "Vui l√≤ng ch·ªçn m√£ s·ªë l·ªãch h·∫πn b·∫°n mu·ªën h·ªßy t·ª´ danh s√°ch:"

  utter_greet:
    - text: |
        <div style="font-family: Arial, sans-serif; font-size: 15px; color: #333; background: #f8faff; border-radius: 10px; padding: 12px 14px; border: 1px solid #cce0ff;">
            <div style="font-weight: bold; color: #007bff; margin-bottom: 6px;">ü§ñ Xin ch√†o!</div>
            <div>T√¥i l√† <strong>chatbot h·ªó tr·ª£ ph√≤ng kh√°m</strong> üè•.<br>
            B·∫°n c·∫ßn t√¥i gi√∫p g√¨ h√¥m nay?</div>
        </div>
      buttons:
        - title: "ü©∫ ƒê·ªÅ xu·∫•t b√°c sƒ©"
          payload: "/request_doctor"
        - title: "üìÖ ƒê·∫∑t l·ªãch h·∫πn"
          payload: "/book_appointment"
        - title: "‚ùå H·ªßy l·ªãch h·∫πn"
          payload: "/cancel_appointment"
        - title: "üíä Tra c·ª©u toa thu·ªëc"
          payload: "/search_prescription"
      metadata:
        html: true

  utter_goodbye:
    - text: "T·∫°m bi·ªát! Ch√∫c b·∫°n s·ª©c kh·ªèe."

  utter_out_of_scope:
    - text: |
        <div style="font-family: Arial, sans-serif; font-size: 15px; color: #333;
                    background: #fff8f8; border-left: 4px solid #dc3545; border-radius: 8px;
                    padding: 12px 14px; margin: 4px 0;">
            <div style="font-weight: bold; color: #dc3545; margin-bottom: 6px;">‚ö†Ô∏è Xin l·ªói!</div>
            <div>T√¥i ch∆∞a ƒë∆∞·ª£c ƒë√†o t·∫°o ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi n√†y.</div>
            <div style="margin-top: 6px;">Hi·ªán t√¥i c√≥ th·ªÉ h·ªó tr·ª£ b·∫°n v·ªõi:</div>
            <ul style="margin: 6px 0 0 18px; padding: 0;">
                <li>ü©∫ <strong>ƒê·ªÅ xu·∫•t b√°c sƒ© ph√π h·ª£p</strong></li>
                <li>üìÖ <strong>ƒê·∫∑t l·ªãch h·∫πn kh√°m</strong></li>
                <li>‚ùå <strong>H·ªßy l·ªãch h·∫πn</strong></li>
                <li>üíä <strong>Tra c·ª©u toa thu·ªëc</strong></li>
                <li>üìã <strong>Tra c·ª©u th√¥ng tin b√°c sƒ© v√† chuy√™n khoa</strong></li>
            </ul>
            <div style="margin-top: 8px;">üëâ B·∫°n mu·ªën t√¥i gi√∫p g√¨ trong s·ªë nh·ªØng vi·ªác tr√™n kh√¥ng?</div>
        </div>
      buttons:
        - title: "ü©∫ ƒê·ªÅ xu·∫•t b√°c sƒ©"
          payload: "/request_doctor"
        - title: "üìÖ ƒê·∫∑t l·ªãch h·∫πn"
          payload: "/book_appointment"
        - title: "üíä Tra c·ª©u toa thu·ªëc"
          payload: "/search_prescription"
      metadata:
        html: true

  # ‚Üê TH√äM: Responses cho t√¨m toa thu·ªëc
  utter_ask_prescription_option:
    - text: |
        <div style="font-family: Arial, sans-serif; font-size: 15px; color: #333;
                    background: #f0f8ff; border-left: 4px solid #17a2b8; border-radius: 8px;
                    padding: 12px 14px; margin: 4px 0;">
            <div style="font-weight: bold; color: #17a2b8; margin-bottom: 6px;">üíä Tra c·ª©u toa thu·ªëc</div>
            <div>B·∫°n mu·ªën t√¨m toa thu·ªëc nh∆∞ th·∫ø n√†o?</div>
        </div>
      buttons:
        - title: "üìã Toa thu·ªëc m·ªõi nh·∫•t"
          payload: "/request_latest_prescription"
        - title: "üìÖ Theo ng√†y kh√°m"
          payload: "/provide_date"
      metadata:
        html: true

  # utter_ask_prescription_date:
  #   - text: "Vui l√≤ng nh·∫≠p ng√†y kh√°m b·∫°n mu·ªën tra c·ª©u toa thu·ªëc (ƒë·ªãnh d·∫°ng DD/MM/YYYY).\nV√≠ d·ª•: 15/10/2025"

  utter_ask_symptoms:
    - text: "B·∫°n ƒëang g·∫∑p tri·ªáu ch·ª©ng g√¨? H√£y m√¥ t·∫£ chi ti·∫øt (c√≥ th·ªÉ li·ªát k√™ nhi·ªÅu, v√≠ d·ª•: 'ƒëau ƒë·∫ßu, s·ªët')."

  utter_ask_specialty:
    - text: "B·∫°n mu·ªën kh√°m chuy√™n khoa n√†o? \nC√°c chuy√™n khoa m√† ch√∫ng t√¥i h·ªó tr·ª£ bao g·ªìm: n·ªôi khoa, ngo·∫°i khoa, nha khoa, ph·ª• s·∫£n, nhi khoa, th·∫ßn kinh. \nVui l√≤ng nh·∫≠p t√™n chuy√™n khoa."

  utter_explain_specialty:
    - text: "B·∫°n mu·ªën t√¨m hi·ªÉu v·ªÅ chuy√™n khoa n√†o? Vui l√≤ng nh·∫≠p t√™n chuy√™n khoa."

  utter_ask_doctor_info:
    - text: "B·∫°n mu·ªën xem th√¥ng tin c·ªßa b√°c sƒ© n√†o? Vui l√≤ng nh·∫≠p t√™n b√°c sƒ©."

  utter_specialty_not_found:
    - text: "Chuy√™n khoa '{specialty}' kh√¥ng h·ª£p l·ªá ho·∫∑c kh√¥ng c√≥ s·∫µn. Vui l√≤ng ch·ªçn t·ª´ danh s√°ch sau ho·∫∑c nh·∫≠p l·∫°i:"

  utter_ask_doctor_name:
    - text: "B·∫°n mu·ªën kh√°m v·ªõi b√°c sƒ© n√†o? Vui l√≤ng ch·ªçn ho·∫∑c nh·∫≠p t√™n b√°c sƒ©."

  utter_doctor_info:
    - text: "B·∫°n mu·ªën tra c·ª©u th√¥ng tin b√°c sƒ© n√†o? Vui l√≤ng nh·∫≠p t√™n b√°c sƒ©."

  utter_ask_appointment_time:
    - text: "B·∫°n mu·ªën ƒë·∫∑t l·ªãch v√†o th·ªùi gian n√†o? Vui l√≤ng cho bi·∫øt th·ªùi gian c·ª• th·ªÉ."

  utter_ask_decription:
    - text: "H√£y cho t√¥i bi·∫øt th√™m chi ti·∫øt v·ªÅ t√¨nh tr·∫°ng c·ªßa b·∫°n."

  utter_ask_date:
    - text: "B·∫°n mu·ªën ƒë·∫∑t l·ªãch v√†o ng√†y n√†o? Vui l√≤ng cho bi·∫øt ng√†y c·ª• th·ªÉ."

  # utter_ask_appointment_date:
  #   - text: "Vui l√≤ng nh·∫≠p ng√†y b·∫°n mu·ªën h·ªßy l·ªãch h·∫πn (ƒë·ªãnh d·∫°ng DD/MM/YYYY)."

  utter_confirm:
    - text: |
        <div style="font-family: Arial, sans-serif; font-size: 15px; color: #333;
                    background: #f9fbff; border-left: 4px solid #007bff; border-radius: 8px;
                    padding: 12px 14px; margin: 4px 0;">
            <div style="font-weight: bold; color: #007bff; margin-bottom: 6px;">üìÖ X√°c nh·∫≠n ƒë·∫∑t l·ªãch</div>
            <div>B·∫°n c√≥ mu·ªën <strong>ƒë·∫∑t l·ªãch v·ªõi b√°c sƒ© n√†y</strong> kh√¥ng?</div>
        </div>
      buttons:
        - title: "‚úÖ C√≥"
          payload: "/affirm"
        - title: "‚ùå Kh√¥ng"
          payload: "/deny"
      metadata:
        html: true

  utter_confirm_booking:
    - text: |
        <div style="font-family: Arial, sans-serif; font-size: 15px; color: #333;
                    background: #fffef5; border-left: 4px solid #ffc107; border-radius: 8px;
                    padding: 12px 14px; margin: 4px 0;">
            <div style="font-weight: bold; color: #ffb300; margin-bottom: 6px;">ü©∫ X√°c nh·∫≠n th√¥ng tin ƒë·∫∑t l·ªãch</div>
            <div><strong>B√°c sƒ©:</strong> {doctor_name}</div>
            <div><strong>Chuy√™n khoa:</strong> {specialty}</div>
            <div><strong>Th·ªùi gian:</strong> {appointment_time} ng√†y {date}</div>
            <div><strong>M√¥ t·∫£ b·ªánh tr·∫°ng:</strong> "{decription}"</div>
            <div style="margin-top: 8px;">üëâ B·∫°n c√≥ mu·ªën x√°c nh·∫≠n ƒë·∫∑t l·ªãch n√†y kh√¥ng?</div>
        </div>
      buttons:
        - title: "‚úÖ C√≥"
          payload: "/affirm"
        - title: "‚ùå Kh√¥ng"
          payload: "/deny"
      metadata:
        html: true

  utter_appointment_cancelled:
    - text: "B·∫°n ƒë√£ h·ªßy ƒë·∫∑t l·ªãch h·∫πn."

  utter_default_error:
    - text: "C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i sau."

  utter_recommend_doctor_no_doctors:
    - text: "Kh√¥ng t√¨m th·∫•y b√°c sƒ© ph√π h·ª£p v·ªõi tri·ªáu ch·ª©ng c·ªßa b·∫°n. Vui l√≤ng th·ª≠ m√¥ t·∫£ kh√°c."

  utter_recommend_doctor_success:
    - text: "D·ª±a tr√™n tri·ªáu ch·ª©ng, t√¥i g·ª£i √Ω chuy√™n khoa: {specialty_suggested}."

  utter_ask_intent:
    - text: |
        <div style="font-family: Arial, sans-serif; font-size: 15px; color: #333;
                    background: #f8faff; border-left: 4px solid #007bff; border-radius: 8px;
                    padding: 12px 14px; margin: 4px 0;">
            <div style="font-weight: bold; color: #007bff; margin-bottom: 6px;">ü§ñ B·∫°n mu·ªën l√†m g√¨ ti·∫øp theo?</div>
            <div>Vui l√≤ng ch·ªçn m·ªôt trong c√°c t√πy ch·ªçn b√™n d∆∞·ªõi üëá</div>
        </div>
      buttons:
        - title: "ü©∫ ƒê·ªÅ xu·∫•t b√°c sƒ©"
          payload: "/request_doctor"
        - title: "üìÖ ƒê·∫∑t l·ªãch h·∫πn"
          payload: "/book_appointment"
        - title: "‚ùå H·ªßy l·ªãch h·∫πn"
          payload: "/cancel_appointment"
        - title: "üíä Tra c·ª©u toa thu·ªëc"
          payload: "/search_prescription"
      metadata:
        html: true

forms:
  cancel_appointment_form:
    required_slots:
      - appointment_date
      - selected_appointment_id

  recommend_doctor_form:
    required_slots:
      - symptoms

  book_appointment_form:
    required_slots:
      - specialty
      - doctor_name
      - date
      - appointment_time
      - decription

  # ‚Üê TH√äM: Form t√¨m toa thu·ªëc
  search_prescription_form:
    required_slots:
      - prescription_date

actions:
  - action_recommend_doctor
  - validate_recommend_doctor_form
  - action_book_with_doctor
  - action_set_current_task
  - validate_book_appointment_form
  - action_book_appointment
  - action_reactivate_book_form
  - action_search_doctor
  - action_view_doctor_detail
  - action_search_specialty
  - action_cancel_appointment
  - validate_cancel_appointment_form
  - action_confirm_cancel
  - action_perform_cancel
  - action_search_prescription
  - action_submit_booking
  - action_reset_booking
  - action_reset_cancel
  - validate_my_form
  - action_deactivate_my_form
  - action_stop_form
  - action_explain_specialty_in_form
  - action_show_doctor_info_in_form
  - action_list_doctors_in_form
  - action_handle_deny
  - action_handle_out_of_scope
  - validate_search_prescription_form # ‚Üê TH√äM M·ªöI
  - action_show_prescription_results # ‚Üê TH√äM M·ªöI
  - action_get_latest_prescription # ‚Üê TH√äM M·ªöI
  - action_show_examining_doctor_in_form

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true
